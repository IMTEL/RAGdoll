<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Service Test UI</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>Chat Service Test UI</h1>

    <div class="endpoint-section">
        <h2>Basic Checks</h2>
        <button onclick="testEndpoint('/', 'GET', 'basic-root-response')">Test GET /</button>
        <button onclick="testEndpoint('/ping', 'GET', 'basic-ping-response')">Test GET /ping</button>
        <pre id="basic-root-response" class="response-area"></pre>
        <pre id="basic-ping-response" class="response-area"></pre>
    </div>

    <div class="endpoint-section">
        <h2>POST /ask</h2>
        <p>Requires a JSON payload representing the `Command` model.</p>
        <textarea id="ask-payload" rows="10" cols="50" placeholder='{
  "progress": [],
  "user_actions": ["start"],
  "NPC": 1,
  "chatLog": [{"role": "user", "content": "What should I do?"}]
}'></textarea><br>
        <button onclick="testAskEndpoint()">Test POST /ask</button>
        <pre id="ask-response" class="response-area"></pre>
    </div>

    <div class="endpoint-section">
        <h2>POST /askTranscribe</h2>
        <p>Requires audio and JSON data (similar to /ask).</p>

        <div>
            <button id="start-record-btn" onclick="startRecording()">Start Recording</button>
            <button id="stop-record-btn" onclick="stopRecording()" disabled>Stop Recording</button>
            <span id="recording-status" style="margin-left: 10px; color: grey;">(Not recording)</span>
        </div>
        <audio id="audio-playback" controls style="margin-top: 10px; display: none;"></audio>
        <p style="margin-top: 10px;"><i>Or upload an audio file:</i></p>
        <label for="audio-file">Audio File:</label>
        <input type="file" id="audio-file" accept=".wav,.mp3,.ogg,.flac"><br>

        <label for="ask-transcribe-payload">JSON Data:</label><br>
        <textarea id="ask-transcribe-payload" rows="10" cols="50" placeholder='{
  "progress": [],
  "user_actions": ["start"],
  "NPC": 1,
  "chatLog": []
}'></textarea><br>
        <button onclick="testAskTranscribeEndpoint()">Test POST /askTranscribe</button>
        <pre id="ask-transcribe-response" class="response-area"></pre>
    </div>

    <div class="endpoint-section">
        <h2>POST /upload/</h2>
        <p>Upload a document (.txt, .pdf, etc.) for RAG processing.</p>
        <label for="upload-file">Document File:</label>
        <input type="file" id="upload-file"><br>
        <label for="upload-npc">NPC ID:</label>
        <input type="number" id="upload-npc" value="0"><br>
        <button onclick="testUploadEndpoint()">Test POST /upload/</button>
        <pre id="upload-response" class="response-area"></pre>
    </div>

    <div class="endpoint-section">
        <h2>Progress API (/api/progress)</h2>
        <button onclick="testEndpoint('/api/progress', 'GET', 'progress-get-response')">Test GET /api/progress</button>
        <pre id="progress-get-response" class="response-area"></pre>
        <hr>
        <p>POST /api/progress/initializeTasks (Requires ListProgressData JSON)</p>
        <textarea id="init-tasks-payload" rows="5" cols="50" placeholder='[{"taskName": "Task 1", "subtaskProgress": []}]'></textarea><br>
        <button onclick="testProgressEndpoint('/api/progress/initializeTasks', 'init-tasks-payload', 'init-tasks-response')">Test POST /initializeTasks</button>
        <pre id="init-tasks-response" class="response-area"></pre>
        <hr>
        <p>POST /api/progress/updateTask (Requires ProgressData JSON)</p>
        <textarea id="update-task-payload" rows="10" cols="50" placeholder='{
  "taskName": "Task 1",
  "status": "start",
  "userId": "test-user",
  "subtaskProgress": []
}'></textarea><br>
        <button onclick="testProgressEndpoint('/api/progress/updateTask', 'update-task-payload', 'update-task-response')">Test POST /updateTask</button>
        <pre id="update-task-response" class="response-area"></pre>
    </div>

    <div class="endpoint-section">
        <h2>Debug API (/api/debug)</h2>
        <button onclick="testEndpoint('/api/debug/logs', 'GET', 'debug-logs-response')">Test GET /api/debug/logs</button>
        <pre id="debug-logs-response" class="response-area"></pre>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>